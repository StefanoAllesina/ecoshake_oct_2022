<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stefano Allesina">

<title>Some serious data massaging</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="ecoshake_data_manipulation_files/libs/clipboard/clipboard.min.js"></script>
<script src="ecoshake_data_manipulation_files/libs/quarto-html/quarto.js"></script>
<script src="ecoshake_data_manipulation_files/libs/quarto-html/popper.min.js"></script>
<script src="ecoshake_data_manipulation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ecoshake_data_manipulation_files/libs/quarto-html/anchor.min.js"></script>
<link href="ecoshake_data_manipulation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ecoshake_data_manipulation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ecoshake_data_manipulation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ecoshake_data_manipulation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ecoshake_data_manipulation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Some serious data massaging</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Stefano Allesina </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="learning-goals" class="level2">
<h2 class="anchored" data-anchor-id="learning-goals">Learning goals</h2>
<p>Showcase some basic and advanced features of <code>tidyverse</code> by practicing on a complex data set.</p>
</section>
<section id="requirements" class="level2">
<h2 class="anchored" data-anchor-id="requirements">Requirements</h2>
<p>Please have the following packages installed before the workshop:</p>
<ul>
<li><code>tidyverse</code> (data manipulation, plotting, and much more)</li>
<li><code>readxl</code> (reading Excel files)</li>
</ul>
<p>Also download the repository</p>
<p><a href="https://github.com/StefanoAllesina/ecoshake_oct_2022/" class="uri">https://github.com/StefanoAllesina/ecoshake_oct_2022/</a></p>
<p>either by cloning it, or by downloading a zip file here</p>
<p><a href="https://github.com/StefanoAllesina/ecoshake_oct_2022/archive/refs/heads/main.zip" class="uri">https://github.com/StefanoAllesina/ecoshake_oct_2022/archive/refs/heads/main.zip</a></p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>For this exercise, we will use data adapted from:</p>
<p><em>Juergen Kreyling</em> et al., Species richness effects on grassland recovery from drought depend on community productivity in a multisite experiment. <em>Ecology Letters</em>, 2017 <a href="https://onlinelibrary.wiley.com/doi/10.1111/ele.12848" class="uri">https://onlinelibrary.wiley.com/doi/10.1111/ele.12848</a></p>
<p>The data are stored in an Excel file, with two sheet: <code>data</code> contains the experimental measures, and <code>species</code> contains taxonomic information for the species used in the experiment.</p>
</section>
<section id="reading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-the-data">Reading the data</h2>
<p>We use the package <code>readxl</code> to import both sheets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># by default, read first sheet</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># you can specify the name of the sheet</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="at">path =</span> <span class="st">"../data/Kreyling_et_al.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"data"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># or specify the index of the sheet (here, 2nd)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="at">path =</span> <span class="st">"../data/Kreyling_et_al.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Other ways to read data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">"my.csv"</span>) <span class="co"># comma-separated values . for decimal</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv2</span>() <span class="co"># semi-colon separated , for decimal</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>() <span class="co"># choices for delimiter, etc.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">read_fwf</span>() <span class="co"># fixed width</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># many more options: see package readr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can take a peek at the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this will show only what fits on the screen</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 × 5
   speciescode           species               genus         family      short…¹
   &lt;chr&gt;                 &lt;chr&gt;                 &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;  
 1 Agrostis capillaris   Agrostis capillaris   Agrostis      Poaceae     Ac     
 2 Anthoxanthum odoratum Anthoxanthum odoratum Anthoxanthum  Poaceae     Ao     
 3 Arrhenatherum elatius Arrhenatherum elatius Arrhenatherum Poaceae     Ae     
 4 Cerastium fontanum    Cerastium fontanum    Cerastium     Caryophyll… Cf     
 5 Epilobium hirsutum    Epilobium hirsutum    Epilobium     Onagraceae  Eh     
 6 Festuca arundinacea   Festuca rubra         Festuca       Poaceae     Fa     
 7 Festuca rubra         Festuca rubra         Festuca       Poaceae     Fr     
 8 Festuca rubra agg.    Festuca rubra         Festuca       Poaceae     Fr     
 9 Holcus lanatus        Holcus lanatus        Holcus        Poaceae     Hl     
10 Hypochoeris radicata  Hypochaeris radicata  Hypochaeris   Asteraceae  Hr     
# … with 16 more rows, and abbreviated variable name ¹​shortname</code></pre>
</div>
</div>
<p>Other ways to look at the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first few rows</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># last few rows</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(dt)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># view in a separate tab</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To just see the structure of the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 10,480
Columns: 14
$ country                                            &lt;chr&gt; "BE", "BE", "BE", "…
$ subset                                             &lt;chr&gt; "invader", "invader…
$ label                                              &lt;chr&gt; "C-12478i", "C-12i"…
$ treatment                                          &lt;chr&gt; "C", "C", "C", "C",…
$ block                                              &lt;dbl&gt; 1, 1, 1, 1, 1, 5, 5…
$ legume                                             &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1…
$ richness                                           &lt;dbl&gt; 6, 3, 6, 6, 6, 6, 6…
$ `date (additional dates below!)`                   &lt;chr&gt; "27/07/15", "27/07/…
$ species                                            &lt;chr&gt; "community", "commu…
$ `species name`                                     &lt;chr&gt; "community", "commu…
$ `Biomass (g dryweight)`                            &lt;dbl&gt; 30.37, 41.10, 28.57…
$ `Individuals survived (at least partly green) (#)` &lt;dbl&gt; NA, NA, NA, NA, NA,…
$ timing                                             &lt;chr&gt; "res", "res", "res"…
$ remark                                             &lt;chr&gt; NA, NA, NA, NA, NA,…</code></pre>
</div>
</div>
</section>
<section id="selecting-columns" class="level2">
<h2 class="anchored" data-anchor-id="selecting-columns">Selecting columns</h2>
<p>The command <code>select</code> is used to select only certain columns. Because we do not need all the 14 columns, we are going to trim the data and overwrite it.</p>
<p>The “pipe” command <code>%&gt;%</code> (Ctrl+Shift+M) takes the tibble on the left as the input for the function on the right: <code>func(x)</code> is equivalent to <code>x %&gt;% func()</code>. When writing code for a long pipeline, put each command in its own line, ending with the pipe. This allows to add/remove parts of the pipeline quickly, as well as to have inline comments to document the code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(label, treatment, country, <span class="st">`</span><span class="at">species name</span><span class="st">`</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>         subset, <span class="st">`</span><span class="at">Biomass (g dryweight)</span><span class="st">`</span>, timing)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,480 × 7
   label    treatment country `species name` subset  Biomass (g dryweig…¹ timing
   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt; 
 1 C-12478i C         BE      community      invader                 30.4 res   
 2 C-12i    C         BE      community      invader                 41.1 res   
 3 C-13478i C         BE      community      invader                 28.6 res   
 4 C-134abi C         BE      community      invader                 52.3 res   
 5 C-13567j C         BE      community      invader                103.  res   
 6 C-138acj C         BE      community      invader                 76.4 res   
 7 C-147bdi C         BE      community      invader                 46.1 res   
 8 C-17i    C         BE      community      invader                 70.3 res   
 9 C-23568j C         BE      community      invader                 64.5 res   
10 C-2357cj C         BE      community      invader                 79.2 res   
# … with 10,470 more rows, and abbreviated variable name
#   ¹​`Biomass (g dryweight)`</code></pre>
</div>
</div>
<p>The backticks are used to specify column names that contain spaces or special characters.</p>
<p>There are many ways to select columns that are handy when there are many columns you would like to retain/remove and do not want to type all of their names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"species"</span>)) <span class="co"># the name contains the word species</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"s"</span>)) <span class="co"># the name ends in s</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"s"</span>)) <span class="co"># the name starts with s</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)) <span class="co"># match names using regex</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(vector_names)) <span class="co"># all the names contained in vector_names (all must be present)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(vector_names)) <span class="co"># all the names contained in vector_names (some can be absent)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="renaming-columns" class="level2">
<h2 class="anchored" data-anchor-id="renaming-columns">Renaming columns</h2>
<p>To make column names shorter or easier to type, use <code>rename</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">biomass =</span> <span class="st">`</span><span class="at">Biomass (g dryweight)</span><span class="st">`</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">species_name =</span> <span class="st">`</span><span class="at">species name</span><span class="st">`</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,480 × 7
   label    treatment country species_name subset  biomass timing
   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; 
 1 C-12478i C         BE      community    invader    30.4 res   
 2 C-12i    C         BE      community    invader    41.1 res   
 3 C-13478i C         BE      community    invader    28.6 res   
 4 C-134abi C         BE      community    invader    52.3 res   
 5 C-13567j C         BE      community    invader   103.  res   
 6 C-138acj C         BE      community    invader    76.4 res   
 7 C-147bdi C         BE      community    invader    46.1 res   
 8 C-17i    C         BE      community    invader    70.3 res   
 9 C-23568j C         BE      community    invader    64.5 res   
10 C-2357cj C         BE      community    invader    79.2 res   
# … with 10,470 more rows</code></pre>
</div>
</div>
</section>
<section id="selecting-rows" class="level2">
<h2 class="anchored" data-anchor-id="selecting-rows">Selecting rows</h2>
<p>For our explorations, we are going to take the data for the experiments ran in Belgium (<code>country == "BE"</code>), for the experiments in which combinations of species for a pool are grown together (<code>subset == "species"</code>); we are going to discard measurements taken on the whole community (<code>species_names != "community"</code>); we are also going to remove records for which the measured biomass is zero or <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"BE"</span>, subset <span class="sc">==</span> <span class="st">"species"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>         species_name <span class="sc">!=</span> <span class="st">"community"</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">is.na</span>(biomass) <span class="sc">==</span> <span class="cn">FALSE</span>, biomass <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>filter</code> accepts one or more logical criteria (they will be combined as <code>AND</code>). There are many other ways to extract subsets of the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">24</span>) <span class="co"># by position</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="dv">10</span>) <span class="co"># 10 random rows</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(biomass, <span class="dv">20</span>) <span class="co"># top 20 rows by biomass</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="dv">10</span>) <span class="co"># first ten rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are special functions to handle missing values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="co"># remove a row if it contains any NA</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(biomass) <span class="co"># remove a row if biomass is NA</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to correct NAs you can use</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">biomass =</span> <span class="dv">0</span>, <span class="at">species_name =</span> <span class="st">"unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-many-species-how-many-treatments" class="level2">
<h2 class="anchored" data-anchor-id="how-many-species-how-many-treatments">How many species? How many treatments?</h2>
<p>We want to determine which species are present in the subset of the data we have extracted. We can use <code>distinct()</code> to remove duplicate entries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this does not alter the data, </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># because we are not assigning it to a tibble</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(species_name) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 1
   species_name         
   &lt;chr&gt;                
 1 Anthoxanthum odoratum
 2 Dactylis glomerata   
 3 Festuca rubra        
 4 Ranunculus acris     
 5 Rumex acetosa        
 6 Stellaria graminea   
 7 Epilobium hirsutum   
 8 Holcus lanatus       
 9 Lotus corniculatus   
10 Trifolium dubium     
11 Trifolium pratense   
12 Vicia sativa         </code></pre>
</div>
</div>
<p>Similarly there should be two treatments: control (<code>C</code>) and drought (<code>D</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(treatment) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 1
  treatment
  &lt;chr&gt;    
1 C        
2 D        </code></pre>
</div>
</div>
<p>We can also check which plots (<code>label</code>) are represented</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(label) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 1
   label   
   &lt;chr&gt;   
 1 C-1     
 2 C-123   
 3 C-123567
 4 C-124678
 5 C-1258cd
 6 C-134578
 7 C-134abc
 8 C-1358ac
 9 C-1467bd
10 C-148   
# … with 62 more rows</code></pre>
</div>
</div>
</section>
<section id="counting" class="level2">
<h2 class="anchored" data-anchor-id="counting">Counting</h2>
<p>We want to check how many times a species has been used for each treatment. We want to produce a table with a count for each species/treatment. We can use <code>count()</code> to get the job done:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> <span class="fu">count</span>(species_name, treatment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
   species_name          treatment     n
   &lt;chr&gt;                 &lt;chr&gt;     &lt;int&gt;
 1 Anthoxanthum odoratum C            21
 2 Anthoxanthum odoratum D            20
 3 Dactylis glomerata    C            20
 4 Dactylis glomerata    D            19
 5 Epilobium hirsutum    C            15
 6 Epilobium hirsutum    D             8
 7 Festuca rubra         C            22
 8 Festuca rubra         D            22
 9 Holcus lanatus        C            22
10 Holcus lanatus        D            22
# … with 14 more rows</code></pre>
</div>
</div>
<p>Similarly, we can count how many species are present at the end of the experiment for each plot. To sort the table from the most speciose to the least, we use <code>arrange</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> <span class="fu">count</span>(label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 2
   label        n
   &lt;chr&gt;    &lt;int&gt;
 1 C-1          2
 2 C-123        6
 3 C-123567    12
 4 C-124678    10
 5 C-1258cd    10
 6 C-134578    10
 7 C-134abc    10
 8 C-1358ac     6
 9 C-1467bd     9
10 C-148        5
# … with 62 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(label) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co"># desc(x) for descending order</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 2
   label        n
   &lt;chr&gt;    &lt;int&gt;
 1 C-123567    12
 2 C-2357ac    12
 3 C-2468ad    11
 4 D-2357ac    11
 5 C-124678    10
 6 C-1258cd    10
 7 C-134578    10
 8 C-134abc    10
 9 C-234568    10
10 C-567abc    10
# … with 62 more rows</code></pre>
</div>
</div>
</section>
<section id="pivoting" class="level2">
<h2 class="anchored" data-anchor-id="pivoting">Pivoting</h2>
<p>The data is in <strong>tidy</strong> form:</p>
<ul>
<li>Each variable is in its own column</li>
<li>Each observation is in its row</li>
</ul>
<p>Tidy data (aka “longer” format) is great for computing, plotting, and manipulation. It is however not great for human consumption. Sometimes we want to produce tables for manuscripts or presentation that are in “wider” format. We can use <code>pivot_longer</code> and <code>pivot_wider</code> to accomplish the transformation back and forth. For example, create a table specifying how many times each species is present in each treatment:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is in tidy (longer) format</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> <span class="fu">count</span>(species_name, treatment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
   species_name          treatment     n
   &lt;chr&gt;                 &lt;chr&gt;     &lt;int&gt;
 1 Anthoxanthum odoratum C            21
 2 Anthoxanthum odoratum D            20
 3 Dactylis glomerata    C            20
 4 Dactylis glomerata    D            19
 5 Epilobium hirsutum    C            15
 6 Epilobium hirsutum    D             8
 7 Festuca rubra         C            22
 8 Festuca rubra         D            22
 9 Holcus lanatus        C            22
10 Holcus lanatus        D            22
# … with 14 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is in wider format</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(species_name, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> treatment, <span class="at">values_from =</span> n) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   species_name              C     D
   &lt;chr&gt;                 &lt;int&gt; &lt;int&gt;
 1 Anthoxanthum odoratum    21    20
 2 Dactylis glomerata       20    19
 3 Epilobium hirsutum       15     8
 4 Festuca rubra            22    22
 5 Holcus lanatus           22    22
 6 Lotus corniculatus       15    17
 7 Ranunculus acris         21    17
 8 Rumex acetosa            20    20
 9 Stellaria graminea       16    15
10 Trifolium dubium         10     9
11 Trifolium pratense       14    16
12 Vicia sativa              3     8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use treatment as column names, and fill each cell with the count</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Anatomy of <code>pivot_wider</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>my_tibble <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># choose columns to pivot, or exclude them using cols = -c(d,e,f)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(a, b), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># which column should we use to create new columns</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> a,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># which column should we use to fill the cells of the new table</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> b,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># what to do with missing data</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_fill =</span> <span class="dv">0</span> <span class="co"># use 0 to fill missing values (default to NA)</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, <code>pivot_longer</code> turns wider data into tidy:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># go back and forth</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(species_name, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># from tidy to wider</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> treatment, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># from wide to tidy</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"treatment"</span>, <span class="at">values_to =</span> <span class="st">"biomass"</span>, <span class="at">cols =</span> <span class="fu">c</span>(C, D))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
   species_name          treatment biomass
   &lt;chr&gt;                 &lt;chr&gt;       &lt;int&gt;
 1 Anthoxanthum odoratum C              21
 2 Anthoxanthum odoratum D              20
 3 Dactylis glomerata    C              20
 4 Dactylis glomerata    D              19
 5 Epilobium hirsutum    C              15
 6 Epilobium hirsutum    D               8
 7 Festuca rubra         C              22
 8 Festuca rubra         D              22
 9 Holcus lanatus        C              22
10 Holcus lanatus        D              22
# … with 14 more rows</code></pre>
</div>
</div>
</section>
<section id="joining-tables" class="level2">
<h2 class="anchored" data-anchor-id="joining-tables">Joining tables</h2>
<p>One of the most powerful features of <code>tidyverse</code> is the possibility of joining different tables as commonly done in data bases. Joining is easiest when the two tables have common columns. For example, say that <code>t1</code> and <code>t2</code> have a common column <code>x</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep all the rows in t1, and if there is a </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># match in t2, combine it with the data from t2</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># if there is no match, you will find NAs</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">right_join</span>(t1, t2)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the same</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> t1 <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(t2)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># left join reverses the table order</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># inner join keeps only the rows in t1 and t2 that are matching</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(t1, t2)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the operation is symmetric</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(t2, t1)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># full join combine both data sets, and keep all the data</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># the row will be complete (no new NAs) only if it is matching</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(t1, t2) <span class="co"># also symmetric</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I often use <code>inner_join</code> or <code>anti_join</code> to do complicated filtering. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">country =</span> <span class="fu">c</span>(<span class="st">"BE"</span>, <span class="st">"BE"</span>, <span class="st">"DE"</span>), </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"D"</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>dt2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  country treatment
  &lt;chr&gt;   &lt;chr&gt;    
1 BE      C        
2 BE      D        
3 DE      D        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dt3 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(dt, dt2) <span class="co"># only keep BE, C; BE, D; DE, D</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>dt3 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(dt, dt2) <span class="co"># exclude BE, C; BE, D; DE, D</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="other-useful-commands" class="level2">
<h2 class="anchored" data-anchor-id="other-useful-commands">Other useful commands</h2>
<ul>
<li><code>as_tibble</code> convert data frame into a tibble</li>
<li><code>enframe</code> convert named vector into a tibble</li>
<li><code>is_tibble</code> check whether it is a tibble</li>
<li><code>bind_rows(a, b)</code> stack two tables with the same col names</li>
<li><code>bind_cols(a,b)</code> stitch two tables with the same number of rows</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>